name: upload ml-pipeline
description: uploads a compiled pipeline
inputs:
- {name: pipeline_package, type: tar.gz}
- {name: pipeline_name, type: string}
- {name: pipeline_version_name, type: string}
outputs:
- {name: pipeline_name, type: string}
implementation:
  container:
    image: python:3.7
    command:
    - sh
    - -c
    - (PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet --no-warn-script-location
      'kfp' || PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet
      --no-warn-script-location 'kfp' --user) && "$0" "$@"
    - python3
    - -u  # Auto-flush. We want the logs to appear in the console immediately.
    - -c  # Inline scripts are easy, but have size limitaions and the error traces do not show source lines.
    - |
      import kfp
      import sys   
      pipeline_package = sys.argv[1] + "/" + sys.argv[2] + ".tar.gz"
      kfp.Client().upload_pipeline_version(pipeline_package_path=pipeline_package,pipeline_name=sys.argv[2],pipeline_version_name=sys.argv[3])
      print(sys.argv[2])
    - {inputPath: pipeline_package}
    - {inputValue: pipeline_name}
    - {inputValue: pipeline_version_name}
