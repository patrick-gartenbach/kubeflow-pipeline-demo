name: upload ml-pipeline
description: uploads a compiled pipeline
inputs:
- {name: Pipeline package, type: tar.gz}
- {name: Pipeline name, type: String}
- {name: Pipeline version name, type: String}
implementation:
  container:
    image: python:3.7
    command:
    - sh
    - -c
    - (PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet --no-warn-script-location
      'kfp' || PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet
      --no-warn-script-location 'kfp' --user) && "$0" "$@"
    - python3
    - -u  # Auto-flush. We want the logs to appear in the console immediately.
    - -c  # Inline scripts are easy, but have size limitaions and the error traces do not show source lines.
    - |
      import kfp
      import sys   
      pipeline_package = sys.argv[1] + "/" + sys.argv[2] + ".tar.gz"
      pipeline_n = sys.argv[2]
      pipeline_v = sys.argv[3]
      print(pipeline_package)
      print(pipeline_n)
      print(pipeline_v)
      kfp.Client().upload_pipeline_version(pipeline_package_path=pipeline_package,pipeline_name=pipeline_n,pipeline_version_name=pipeline_v)
      print(sys.argv[2])
    - {inputPath: Pipeline package}
    - {inputValue: Pipeline name}
    - {inputValue: Pipeline version name}
